= TKoolImageTileEditor
:toc: left
:sectnums:

image:https://github.com/jiro4989/TKoolImageTileEditor/workflows/build/badge.svg[build, link=https://github.com/jiro4989/TKoolImageTileEditor/actions]
image:https://codecov.io/gh/jiro4989/TKoolImageTileEditor/branch/master/graph/badge.svg[codecov, link=https://codecov.io/gh/jiro4989/TKoolImageTileEditor]

image::./docs/demo.gif[]

== 概要

このソフトは、タイル画像ファイルを簡単に編集するためのツールです。

本ソフトでは以下のような処理が可能です。

- マウスクリックした画像タイルの削除
- マウスクリックした画像タイルの削除と、削除後の空白埋め
- マウスクリックした画像タイルの左右反転
- マウスクリックした画像タイルの位置交換
- 複数画像タイルの連結
- ツクール以外の独自画像規格の追加

Mac環境では未確認ですが、Windows, Mac, LinuxといったメジャーなOSであればどの環境
でも動作するはずです。

== インストール

https://github.com/jiro4989/TKoolImageTileEditor/releases[Releases]から各プラッ
トフォーム向けの圧縮ファイルをダウンロードして展開する。
圧縮ファイル内にはいくつかファイルがあるが、これらはセットで必要。任意のフォル
ダなどに移動したい場合は、展開したフォルダごと移動すること。

=== 初回起動時に生成されるフォルダ

[options="header"]
|=================
| log        | 最近開いたファイルログ
| presets    | 画像規格ファイル
| properties | 設定ファイル
|=================

上記の生成されるフォルダ類は、アンインストールする時以外に場所を移動したり、削除
したりしないようにしてください。予期せぬ動作の原因になります。

== 起動手順

. (Windows) fkite.batをダブルクリックする
.. このとき警告が出る場合があるけれど、許可する
.. 黒いウィンドウが表示されるが、閉じないで待つ
.. GUIの画面が表示される
. (Mac/Linux) fkiteを実行する

== 使い方

=== ファイルを開く

ファイルメニューの"開く"を選択して、編集したい画像ファイルを選択したください。

=== 画像の確認

ウィンドウ左側のファイルリストに画像ファイルが追加されたことを確認してください。
この時、同時に画面右側の画像出力パネルに画像が表示されていれば、正常に動作してい
ます。

もしこの時、画像出力パネルに画像が表示されていなければ、読み込んだ画像の規格と編
集するための画像の規格が異なっている可能性があります。

その場合は、ファイルメニューから"プリセットを開く"を選択して、画像の規格を変更し
てください。

デフォルトで生成される画像規格プリセットは以下の通りです。

- mv.preset      : RPGツクールMV    の顔画像タイル用
- vxace.preset   : RPGツクールVXACE の顔画像タイル用
- iconset.preset : RPGツクールMV    のアイコン画像タイル用

また、これらのプリセット以外の独自規格を新たに追加することも可能です。プリセット
追加についての詳細は[画像規格プリセット](#画像規格プリセット)の項目を参照してく
ださい。

=== 編集モードの変更

編集したい画像が出力画像パネルに表示されたら、パネル操作変更のパネルから操作した
いモードを選択してください。これは出力画像パネルをマウスでクリックした時の動作を
変更します。

各種パネルのモードは以下のとおりです。

- 削除モード
    クリックしたパネルの画像を空(透明色のみ)にします。

- 削除モード(空白埋め)
    クリックしたパネルの画像を削除し、クリックした画像以降の画像を移動して空白を
    詰めます。一番末尾の画像には空の画像が挿入されます。

- 並べ替えモード
    2つ画像をクリックすると、クリックされた画像の位置が交換されます。

- 左右反転モード
    クリックした画像を左右反転します。

=== 画像の編集

出力画像パネルをマウスクリックして編集してください。操作変更パネルのモードの動作
をクリックしたパネルに適用します。

編集した画像を最初の状態に復元したい場合は、ファイルリストのリロードボタンを選択
してください。選択中の画像を出力画像パネルに表示し直します。

注意点として、本ソフトでは「元に戻す・やり直す」といった機能は実装していません。
編集を誤ったと思ったときはリロードボタンを押して編集前の最初の状態に戻すことしか
できません。

=== 画像の保存

ファイルメニューから保存、または名前をつけて保存を選択してください。

ただし、この操作を行うとリロードボタンを押しても画像を編集前に戻すことはできなく
なります。

=== 画像の確認

エクスプローラで画像をダブルクリックして画像を正常に保存されていることを確認して
ください。

もしこの時、出力画像パネルの表示と異なる画像が表示されいた場合は、連絡先から製作
者ブログにバグ報告していただけると助かります。

=== 複数画像の連結

RPGツクールの標準で利用可能な画像は行列2×4の8枚の画像によって構成されています。

しかし、画像の横幅を維持していれば、縦幅を拡大した画像でも読み込んで正常に使用す
ることが可能です。

この仕様を利用すれば、複数の画像を1枚の画像タイルにまとめることができます。また
は、同じアクターの異なる表情差分ファイルを1枚の画像ファイルにまとめて管理するこ
とが可能です。

本ソフトではこういった用途でも利用できるように、ファイルの連結機能を実装していま
す。

==== 連結ファイルの選択

連結したいファイルを選択します。

連結するファイルは選択したファイルの先頭のファイルの画像サイズを基準にフィルタリ
ングします。よって、画像サイズの異なるファイルも同時に開いた場合、先頭のファイル
と画像のサイズが異なっていた場合は除外されます。

連結する画像の選択が完了したら、次に連結した画像を取り扱うためのプリセットを生成
します。プリセットの保存ダイアログにしたがって、保存するプリセットの名前を入力し
てください。

プリセットの名前が決定したら、プリセットの編集を行います。詳細は[プリセットの編
集](#プリセットの編集)の項目を参照してください。

=== 画像規格プリセット

本ソフトではTKoolとタイトルに銘打っているとおり、RPGツクールシリーズのタイル画像
を編集するためのものです。

しかし、汎用性と柔軟性を持たせるために、プリセットを利用することによって、ツクー
ル以外の画像規格にも柔軟に対応できるようにしています。

例えばRPGツクールで新たなバージョンが登場した時に、画像の規格が変更された場合に
も対応できるようになっています。

==== 新規プリセット

新たな画像規格プリセットを生成します。プリセットには任意の名前をつけることが可能
です。

ファイル保存ダイアログから保存するファイル名を入力すると、プリセットの編集画面に
遷移します。

プリセット編集画面の詳細は[プリセットの編集](#プリセットの編集)の項目を参照して
ください。

==== プリセットを開く

画像規格プリセットを変更します。本ソフト実行時に自動生成されるプリセットはすべて
presetsフォルダで管理されます。

プリセットは最初に自動生成されるのがpresetsフォルダであるというだけなので、任意
の場所で管理できます。

==== プリセットの編集

プリセットの編集画面を表示します。

この画面では行、列、1タイルの画像幅を設定します。

プレビュー画像を読み込むと、画面右側の規格プレビューの下に比較用の画像を表示する
ことができます。

ファイルリストに編集したい画像を追加していた場合は、選択中のファイルをプレビュー
画像として読み込みます。

また、プレビュー画像を読み込むと行列からサイズを設定ボタンとサイズから行列を設定
ボタンが使用可能になります。

==== プリセット編集画面の操作方法

- 行、列、サイズの項目の左右にあるボタンは数値の増減を扱います。

- 行、列、サイズの項目のテキスト入力欄上のでマウスホイールを使用すると、値を増
  減します。

- マウスホイールによる値の操作時にCtrlキー、またはShiftキーを押すと値の上限幅
  を変更できます。

  - Ctrl  :  5ずつ増減
  - Shift : 10ずつ増減

==== 行列からサイズを設定

画像タイルの横のタイル数、縦のタイル数がわかっている場合に利用するボタンです。

行、列の値を入力してからボタンを押すと、プレビューの画像からサイズを計算して入力
します。

==== サイズから行列を設定

画像タイルの1タイルのピクセル幅がわかっている場合に利用するボタンです。

サイズの値を入力してからボタンを押すと、プレビューの画像から行、列を計算して入力
します。

=== ショートカットキー

[options="header"]
|=========
| キー | 動作 | 備考 
| Ctrl-O | ファイルを開く | 
| Ctrl-S | ファイルを保存 | 上書き保存 
| Ctrl-Shift-S | 名前をつけて保存 | 
| Ctrl-Shift-N | 新規プリセット | 
| Ctrl-Shift-O | プリセットを開く | 
| Ctrl-Shift-E | プリセットを編集 | 
| R | 選択中の画像を再描画 | 上書き保存でリロードできなくなる 
| D | 選択中のファイルを削除 | 
| C | ファイルリストをクリア | 
| F1 | バージョン情報 | 
|=========

== アンインストール

フォルダごと削除する。

== 連絡先

バグ報告、機能要望、質問などがあれば、リポジトリのissuesに起票ください。

それ以外については、以下に連絡ください。

https://twitter.com/jiro_saburomaru[@jiro_saburomaru]

== LICENSE

GPL-2.0

== 開発者向け

=== 前提条件

* Java 14

環境変数JAVA_HOMEも設定すること。
以下のコマンドでUbuntuでは環境が整う。

[source,bash]
----
curl -O https://download.java.net/java/GA/jdk14/076bab302c7b4508975440c56f6cc26a/36/GPL/openjdk-14_linux-x64_bin.tar.gz
tar xvf openjdk-14_linux-x64_bin.tar.gz

mkdir -p /opt/java
mv jdk-14 /opt/java/
ln -sfn /opt/java/jdk-14 /opt/java/current

export JAVA_HOME=/opt/java/current
----

=== ビルド手順

以下のコマンドを実行する。

[source,bash]
----
./gradlew build
----

=== アプリ起動手順

前述のビルドコマンドを実行後に以下のコマンドを実行する。

実行する前提条件として、下記スクリプトにかかれている `module-path`
のパスにJavaFX SDKがインストールされている必要がある。 JavaFX SDKは
https://gluonhq.com/products/javafx/[JavaFXのサイト]
からSDKをダウンロードしてきて圧縮ファイルを展開して配置する。

[source,bash]
----
./gradlew clean build runApp
----

=== カスタムJREの作成手順

以下のコマンドを実行する。成果物としてjreディレクトリが作成される。

アプリが依存しているモジュールは `modules.txt`
に記載。ここに追記するとスクリプトにも反映される。

実行する前提条件として、前述のJavaFXのサイトにて配布されているJMODSが必要。
こちらをダウンロードしてきて、 `./jmods/javafx-jmods-11.0.2` に配置する。

配置後に以下のコマンドを実行する。

[source,bash]
----
./gradlew jlink
----

=== カスタムJREを使用してアプリを起動する手順

以下の手順を実施する。

* ビルド手順
* カスタムJRE作成手順

実施の後、以下のコマンドを実行する。

[source,bash]
----
./jre/bin/java -jar build/libs/fkite-dev.jar com.jiro4989.fkite.Main
----

これで起動しなければ何かがおかしい。

=== リリース手順

リリースドラフトをpublishすると配布物がリリースされる。
リリースはすべてCI環境で行うため、環境を整える必要はない。

masterブランチが更新されるとGitHubActionsが走る。
masterでGitHubActionsが走ると、リリースのドラフトが作成される。
リリースドラフトをpublishすると、GitHubActionsが起動する。

タグを切ったときのGitHubActionsのワークフローでは、
前述のビルドとカスタムJRE作成と同様の処理が走る。

生成された各プラットフォーム向けの配布物をGitHubReleaseに添付する。

